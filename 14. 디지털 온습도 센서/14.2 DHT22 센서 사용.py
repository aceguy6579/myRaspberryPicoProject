from machine import Pin, I2C
from PicoDHT22 import PicoDHT22
from utime import sleep
from ssd1306 import SSD1306_I2C
import framebuf

data = [ # 32x32 크기 비트맵 데이터
    0x00, 0x00, 0x00, 0x00, 0x07, 0xC0, 0x00, 0x00,
    0x07, 0xE0, 0x00, 0x18, 0x04, 0x20, 0x00, 0x18,
    0x04, 0x38, 0x00, 0x3C, 0x04, 0x20, 0x00, 0x24,
    0x04, 0x30, 0x00, 0x66, 0x04, 0x30, 0x00, 0x24,
    0x04, 0x20, 0x00, 0x3C, 0x05, 0xB8, 0x00, 0x00,
    0x05, 0xA0, 0x06, 0x00, 0x05, 0xA0, 0x0E, 0x00,
    0x05, 0xB0, 0x0B, 0x00, 0x05, 0xA0, 0x19, 0x00,
    0x05, 0xB8, 0x11, 0x80, 0x05, 0xA0, 0x11, 0x80,
    0x05, 0xA0, 0x1B, 0x00, 0x0D, 0xA0, 0x0E, 0x00,
    0x19, 0xB8, 0x00, 0x18, 0x31, 0x8C, 0x00, 0x18,
    0x21, 0x84, 0x00, 0x24, 0x67, 0xC6, 0x00, 0x66,
    0x47, 0xE2, 0x00, 0x42, 0x47, 0xE2, 0x00, 0x42,
    0x47, 0xE2, 0x00, 0x42, 0x47, 0xC6, 0x00, 0x7E,
    0x61, 0x84, 0x00, 0x18, 0x30, 0x0C, 0x00, 0x00,
    0x18, 0x18, 0x00, 0x00, 0x0F, 0xF0, 0x00, 0x00,
    0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
]
icon = bytearray(data) # 온습도 아이콘
fb = framebuf.FrameBuffer(icon, 32, 32, framebuf.MONO_HLSB)

dht_sensor=PicoDHT22(Pin(22,Pin.IN,Pin.PULL_UP),dht11=True)
i2c=I2C(0, sda = Pin(0), scl = Pin(1), freq=400000) # I2C 포트 사용
oled = SSD1306_I2C(128, 64, i2c, 0x3C) # OLED 디스플레이 제어 객체

while True:
    T, H = dht_sensor.read() # 온도와 습도 읽기
    oled.fill(0) # 화면 버퍼 지우기

    if T is None:
        print("Sensor error")
    else:
        print("{}'C {}%".format(T, H))

        oled.blit(fb, 0, 16) # 아이콘 표시
        # 실수를 5칸에 소수점 이하 한 자리로 오른쪽 정렬해서 표시
        oled.text("T: {0:>5.1f}'C".format(T), 40, 20)
        oled.text("H: {0:>5.1f} %".format(H), 40, 35)
        oled.show()

    sleep(2) # DHT22를 위해서는 최소 2초 간격 필요